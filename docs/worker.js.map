{"version":3,"sources":["webpack://bank-puzzle/./node_modules/events/events.js","webpack://bank-puzzle/./node_modules/grain-rpc/dist/lib/index.js","webpack://bank-puzzle/./node_modules/grain-rpc/dist/lib/message.js","webpack://bank-puzzle/./node_modules/grain-rpc/dist/lib/rpc.js","webpack://bank-puzzle/./node_modules/ts-interface-checker/dist/index.js","webpack://bank-puzzle/./node_modules/ts-interface-checker/dist/types.js","webpack://bank-puzzle/./node_modules/ts-interface-checker/dist/util.js","webpack://bank-puzzle/webpack/bootstrap","webpack://bank-puzzle/./app/worker.ts"],"names":["ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","prototype","call","ownKeys","Object","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","value","EventEmitter","init","this","module","exports","once","emitter","name","Promise","resolve","reject","eventListener","undefined","errorListener","removeListener","slice","arguments","err","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","warning","create","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","bind","_listeners","unwrap","evlistener","arr","ret","Array","i","unwrapListeners","arrayClone","listenerCount","n","copy","defineProperty","enumerable","get","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","handler","len","listeners","addListener","on","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","key","keys","rawListeners","eventNames","__export","p","hasOwnProperty","MsgType","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","e","rejected","result","done","then","events_1","tic","message_1","plainCall","callFunc","Rpc","options","super","_sendMessageCB","_inactiveRecvQueue","_inactiveSendQueue","_waitForReadyMessage","_implMap","Map","_forwarders","_pendingCalls","_nextRequestId","logger","sendMessage","callWrapper","_logger","_callWrapper","setSendMessage","msg","_dispatch","processQueue","_processOutgoing","_queueOutgoing","_sendMessage","mtype","Ready","data","postMessageForward","fwdDest","Custom","mdest","impl","checker","has","invokeImpl","meth","ttype","getType","TIface","argsCheckers","prop","props","TFunc","methodArgs","fwdName","dest","passThru","c","forwardCall","assign","forwardMessage","delete","parts","_parseName","getStubForward","forwarder","api","resultChecker","methodResult","_makeCall","Proxy","property","anyChecker","registerImpl","invoke","checkerAnyFunc","unregisterImpl","callRemoteFuncForward","iface","_sendMessageOrReject","info","desc","RpcCall","_callDesc","catchMaybePromise","_sendReject","newErr","ErrorWithCode","reqId","callObj","_info","_makeCallRaw","_onMessageCall","RpcRespData","RpcRespErr","_onMessageResp","_onCustomMessage","_warn","_failCall","argsChecker","check","code","_sendResponse","mesg","reportCode","resp","idx","lastIndexOf","substr","IAnyFunc","func","createCheckers","queue","processFunc","splice","callback","catch","__spreadArrays","s","il","r","k","a","j","jl","Checker","types_1","util_1","types_2","TArray","TEnumType","TEnumLiteral","TLiteral","TName","TOptional","TParam","TParamList","TProp","TTuple","TType","TUnion","TIntersection","array","enumlit","enumtype","lit","opt","param","tuple","union","intersection","BasicType","util_2","VError","typeSuite","_i","fullSuite","basicTypes","checkers","_a","typeSuite_1","suite_1","_b","_c","suite","_path","checkerPlain","getChecker","checkerStrict","setReportedPath","path","_doCheck","test","NoopContext","validate","_doValidate","strictCheck","strictTest","strictValidate","getProp","methodName","tfunc","_getMethod","paramList","getArgs","getResult","checkerFunc","detailCtx","DetailContext","getError","getErrorDetail","extendStatics","__extends","d","b","setPrototypeOf","__proto__","__","constructor","parseSpec","typeSpec","getNamedType","_super","_this","_failMsg","strict","allowedProps","ctx","fail","JSON","stringify","itemChecker","isArray","map","t","ttypes","itemCheckers","names","filter","otherTypes","join","ur","unionResolver","createContext","resolveUnion","Set","every","values","members","validValues","enumName","val","bases","makeIfaceProp","makeIfaceProps","propSet","baseCheckers","propCheckers","testCtx","isPropRequired","isOpt","name_1","v","forEach","add","resultSpec","params","Boolean","isParamRequired","validator","any","number","object","boolean","string","symbol","void","null","never","Date","getIsNativeChecker","RegExp","nativeToString","toString","tag","Buffer","isBuffer","_loop_1","array_1","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","ArrayBuffer","relPath","score","_propNames","_messages","_score","DetailUnionResolver","best","contexts","msgParts","details","detail","nested","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","rpc","postMessage","onmessage","ev","receiveMessage","bank","getStub","registerFunc","async","userFunc","transfer","getBalance"],"mappings":"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","file":"worker.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function eventListener() {\n      if (errorListener !== undefined) {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n    var errorListener;\n\n    // Adding an error listener is not optional because\n    // if an error is thrown on an event emitter we cannot\n    // guarantee that the actual event we are waiting will\n    // be fired. The result could be a silent way to create\n    // memory or file descriptor leaks, which is something\n    // we should avoid.\n    if (name !== 'error') {\n      errorListener = function errorListener(err) {\n        emitter.removeListener(name, eventListener);\n        reject(err);\n      };\n\n      emitter.once('error', errorListener);\n    }\n\n    emitter.once(name, eventListener);\n  });\n}\n","\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./message\"));\n__export(require(\"./rpc\"));\n","\"use strict\";\n/**\n * This defines the message types sent over an RpcChannel.\n *\n * WARNING: Any changes to these must be backward-compatible, since Rpc may be used across\n * different versions of this library. Specifically, enums must not be renumbered, fields renamed,\n * or their types changed. Really, the only reasonable enhancement is adding a new optional field.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar MsgType;\n(function (MsgType) {\n    // Warning: Do NOT renumber enums (see warning above).\n    MsgType[MsgType[\"RpcCall\"] = 1] = \"RpcCall\";\n    MsgType[MsgType[\"RpcRespData\"] = 2] = \"RpcRespData\";\n    MsgType[MsgType[\"RpcRespErr\"] = 3] = \"RpcRespErr\";\n    MsgType[MsgType[\"Custom\"] = 4] = \"Custom\";\n    MsgType[MsgType[\"Ready\"] = 5] = \"Ready\";\n})(MsgType = exports.MsgType || (exports.MsgType = {}));\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Rpc implements an remote-procedure-call interface on top of a simple messaging interface.\n *\n * The user must provide the messaging between two endpoints, and in return gets the ability to\n * register interfaces or functions at either endpoint, and call them from the other side. For\n * messaging, the user must supply a sendMessage() function to send messages to the other side,\n * and must call rpc.receiveMessage(msg) whenever a message is received.\n *\n * E.g.\n *    rpc.registerImpl<MyInterface>(\"some-name\", new MyInterfaceImpl(), descMyInterfaceImpl);\n *    rpc.getStub<MyInterface>(\"some-name\", descMyInterfaceImpl)\n *          => returns a stub implemeting MyInterface\n *\n * Calls to the generated stub get turned into messages across the channel, and then call to the\n * implementation object registered on the other side. Both return values and exceptions get\n * passed back over the channel, and cause the promise from the stub to be resolved or rejected.\n *\n * Note that the stub interface returns Promises for all methods.\n *\n * Rpc library supports ts-interface-checker descriptors for the interfaces, to allow validation.\n * You may skip it by passing in `rpc.unchecked` where a descriptor is expected; it will skip\n * checks and you will not get descriptive errors.\n *\n * The string name used to register and use an implementation allows for the same Rpc object to be\n * used to expose multiple interfaces, or different implementations of the same interface.\n *\n * Messaging\n * ---------\n * Rpc also supports a messaging interface, with postMessage() to send arbitrary messages, and an\n * EventEmitter interface for \"message\" events to receive them, e.g. on(\"message\", ...). So if you\n * need to multiplex non-Rpc messages over the same channel, Rpc class does it for you.\n *\n * Cleanup\n * -------\n * If the channel is closed or had an error, and will no longer be used, the user of Rpc must\n * call rpc.close() to reject any calls waiting for an answer.\n *\n * If a particular stub for a remote API is no longer needed, user may call rpc.discardStub(stub)\n * to reject any pending calls made to that stub.\n *\n * Timeouts\n * --------\n * TODO (Not yet implementd.)\n * You may call rpc.setTimeout(ms) or rpc.setStubTimeout(stub, ms) to set a call timeout for all\n * stubs or for a particular one. If a response to a call does not arrive within the timeout, the\n * call gets rejected, and the rejection Error will have a \"code\" property set to \"TIMEOUT\".\n *\n * Forwarding\n * ----------\n * Rpc.registerForwarder() along with methods with \"-Forward\" suffix allow one Rpc object to forward\n * calls and messages to another Rpc object. The intended usage is when Rpc connects A to B, and B\n * to C. Then B can use registerForwarder to expose A's interfaces to C (or C's to A) without having\n * to know what exactly they are. A default forwarder can be registered using the '*' name.\n *\n *\n * Instead of using getStubForward and callRemoteFuncForward, the forwarder name can be\n * appended to the interface name as \"interfaceName@forwarderName\" and the regular\n * getStub and callRemoteFunc methods can be used.  For example:\n *   getStub(\"iface@forwarder\")\n * is the same as:\n *   getStubForward(\"forwarder\", \"iface\")\n *\n *\n * E.g. with A.registerImpl(\"A-name\", ...) and B.registerForwarder(\"b2a\", A), we may now call\n * C.getStubForward(\"b2a\", \"A-name\") to get a stub that will forward calls to A, as well as\n * C.postMessageForward(\"b2a\", msg) to have the message received by A.\n *\n * TODO We may want to support progress callbacks, perhaps by supporting arbitrary callbacks as\n * parameters. (Could be implemented by allowing \"meth\" to be [reqId, paramPath]) It would be nice\n * to allow the channel to report progress too, e.g. to report progress of uploading large files.\n *\n * TODO Sending of large files should probably be a separate feature, to allow for channel\n * implementations to stream them.\n */\nconst events_1 = require(\"events\");\nconst tic = require(\"ts-interface-checker\");\nconst message_1 = require(\"./message\");\nconst plainCall = (callFunc) => callFunc();\nclass Rpc extends events_1.EventEmitter {\n    /**\n     * To use Rpc, you must provide a sendMessage function that sends a message to the other side;\n     * it may be given in the constructor, or later with setSendMessage. You must also call\n     * receiveMessage() for every message received from the other side.\n     */\n    constructor(options = {}) {\n        super();\n        // Note the invariant: _inactiveSendQueue == null iff (_sendMessageCB != null && !_waitForReadyMessage)\n        this._sendMessageCB = null;\n        this._inactiveRecvQueue = null; // queue of received message\n        this._inactiveSendQueue = null; // queue of messages to be sent\n        this._waitForReadyMessage = false;\n        this._implMap = new Map();\n        this._forwarders = new Map();\n        this._pendingCalls = new Map();\n        this._nextRequestId = 1;\n        const { logger = console, sendMessage = null, callWrapper = plainCall } = options;\n        this._logger = logger;\n        this._callWrapper = callWrapper;\n        this.setSendMessage(sendMessage);\n    }\n    /**\n     * To use Rpc, call this for every message received from the other side of the channel.\n     */\n    receiveMessage(msg) {\n        if (this._inactiveRecvQueue) {\n            this._inactiveRecvQueue.push(msg);\n        }\n        else {\n            this._dispatch(msg);\n        }\n    }\n    /**\n     * If you've set up calls to receiveMessage(), but need time to call registerImpl() before\n     * processing new messages, you may use queueIncoming(), make the registerImpl() calls,\n     * and then call processIncoming() to handle queued messages and resume normal processing.\n     */\n    queueIncoming() {\n        if (!this._inactiveRecvQueue) {\n            this._inactiveRecvQueue = [];\n        }\n    }\n    /**\n     * Process received messages queued since queueIncoming, and resume normal processing of\n     * received messages.\n     */\n    processIncoming() {\n        if (this._inactiveRecvQueue) {\n            processQueue(this._inactiveRecvQueue, this._dispatch.bind(this));\n            this._inactiveRecvQueue = null;\n        }\n    }\n    /**\n     * Set the callback to send messages. If set to null, sent messages will be queued. If you\n     * disconnect and want for sent messages to throw, set a callback that throws.\n     */\n    setSendMessage(sendMessage) {\n        this._sendMessageCB = sendMessage;\n        if (this._sendMessageCB) {\n            this._processOutgoing();\n        }\n        else {\n            this._queueOutgoing();\n        }\n    }\n    /**\n     * If your peer may not be listening yet to your messages, you may call this to queue outgoing\n     * messages until receiving a \"ready\" message from the peer. I.e. one peer may call\n     * queueOutgoingUntilReadyMessage() while the other calls sendReadyMessage().\n     */\n    queueOutgoingUntilReadyMessage() {\n        this._waitForReadyMessage = true;\n        this._queueOutgoing();\n    }\n    /**\n     * If your peer is using queueOutgoingUntilReadyMessage(), you should let it know that you are\n     * ready using sendReadyMessage() as soon as you've set up the processing of received messages.\n     * Note that at most one peer may use queueOutgoingUntilReadyMessage(), or they will deadlock.\n     */\n    sendReadyMessage() {\n        return this._sendMessage({ mtype: message_1.MsgType.Ready });\n    }\n    /**\n     * Messaging interface: send data to the other side, to be emitted there as a \"message\" event.\n     */\n    postMessage(data) { return this.postMessageForward(\"\", data); }\n    postMessageForward(fwdDest, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const msg = { mtype: message_1.MsgType.Custom, data };\n            if (fwdDest) {\n                msg.mdest = fwdDest;\n            }\n            yield this._sendMessage(msg);\n        });\n    }\n    registerImpl(name, impl, checker) {\n        if (this._implMap.has(name)) {\n            throw new Error(`Rpc.registerImpl has already been called for ${name}`);\n        }\n        const invokeImpl = (call) => impl[call.meth](...call.args);\n        if (!checker) {\n            this._implMap.set(name, { name, invokeImpl, argsCheckers: null });\n        }\n        else {\n            const ttype = checker.getType();\n            if (!(ttype instanceof tic.TIface)) {\n                throw new Error(\"Rpc.registerImpl requires a Checker for an interface\");\n            }\n            const argsCheckers = {};\n            for (const prop of ttype.props) {\n                if (prop.ttype instanceof tic.TFunc) {\n                    argsCheckers[prop.name] = checker.methodArgs(prop.name);\n                }\n            }\n            this._implMap.set(name, { name, invokeImpl, argsCheckers });\n        }\n    }\n    registerForwarder(fwdName, dest, fwdDest = (fwdName === \"*\" ? \"*\" : \"\")) {\n        const passThru = fwdDest === \"*\";\n        this._forwarders.set(fwdName, {\n            name: \"[FWD]\" + fwdName,\n            argsCheckers: null,\n            invokeImpl: (c) => dest.forwardCall(Object.assign({}, c, { mdest: passThru ? c.mdest : fwdDest })),\n            forwardMessage: (msg) => dest.forwardMessage(Object.assign({}, msg, { mdest: passThru ? msg.mdest : fwdDest })),\n        });\n    }\n    unregisterForwarder(fwdName) {\n        this._forwarders.delete(fwdName);\n    }\n    /**\n     * Unregister an implementation, if one was registered with this name.\n     */\n    unregisterImpl(name) {\n        this._implMap.delete(name);\n    }\n    getStub(name, checker) {\n        const parts = this._parseName(name);\n        return this.getStubForward(parts.forwarder, parts.name, checker);\n    }\n    getStubForward(fwdDest, name, checker) {\n        if (!checker) {\n            // TODO Test, then explain how this works.\n            return new Proxy({}, {\n                get: (target, property, receiver) => {\n                    if (property === \"then\") {\n                        // By default, take care not to look \"thenable\", so that the stub can be returned\n                        // as a value of a Promise:\n                        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve\n                        // If user really wants to proxy \"then\", they can write a checker.\n                        return undefined;\n                    }\n                    return (...args) => this._makeCall(name, property, args, anyChecker, fwdDest);\n                },\n            });\n        }\n        else {\n            const ttype = checker.getType();\n            if (!(ttype instanceof tic.TIface)) {\n                throw new Error(\"Rpc.getStub requires a Checker for an interface\");\n            }\n            const api = {};\n            for (const prop of ttype.props) {\n                if (prop.ttype instanceof tic.TFunc) {\n                    const resultChecker = checker.methodResult(prop.name);\n                    api[prop.name] = (...args) => this._makeCall(name, prop.name, args, resultChecker, fwdDest);\n                }\n            }\n            return api;\n        }\n    }\n    /**\n     * Simple way to registers a function under a given name, with no argument checking.\n     */\n    registerFunc(name, impl) {\n        return this.registerImpl(name, { invoke: impl }, checkerAnyFunc);\n    }\n    /**\n     * Unregister a function, if one was registered with this name.\n     */\n    unregisterFunc(name) {\n        return this.unregisterImpl(name);\n    }\n    /**\n     * Call a remote function registered with registerFunc. Does no type checking.\n     */\n    callRemoteFunc(name, ...args) {\n        const parts = this._parseName(name);\n        return this.callRemoteFuncForward(parts.forwarder, parts.name, ...args);\n    }\n    callRemoteFuncForward(fwdDest, name, ...args) {\n        return this._makeCall(name, \"invoke\", args, anyChecker, fwdDest);\n    }\n    forwardCall(c) {\n        return this._makeCall(c.iface, c.meth, c.args, anyChecker, c.mdest || \"\");\n    }\n    forwardMessage(msg) {\n        return this.postMessageForward(msg.mdest || \"\", msg.data);\n    }\n    // Mark outgoing messages for queueing.\n    _queueOutgoing() {\n        if (!this._inactiveSendQueue) {\n            this._inactiveSendQueue = [];\n        }\n    }\n    // If sendMessageCB is set and we are no longer waiting for a ready message, send out any\n    // queued outgoing messages and resume normal sending.\n    _processOutgoing() {\n        if (this._inactiveSendQueue && this._sendMessageCB && !this._waitForReadyMessage) {\n            processQueue(this._inactiveSendQueue, this._sendMessageOrReject.bind(this, this._sendMessageCB));\n            this._inactiveSendQueue = null;\n        }\n    }\n    _sendMessage(msg) {\n        if (this._inactiveSendQueue) {\n            this._inactiveSendQueue.push(msg);\n        }\n        else {\n            return this._sendMessageOrReject(this._sendMessageCB, msg);\n        }\n    }\n    // This helper calls calls sendMessage(msg), and if that call fails, rejects the call\n    // represented by msg (when it's of type RpcCall).\n    _sendMessageOrReject(sendMessage, msg) {\n        if (this._logger.info) {\n            const desc = (msg.mtype === message_1.MsgType.RpcCall) ? \": \" + this._callDesc(msg) : \"\";\n            this._logger.info(`Rpc sending ${message_1.MsgType[msg.mtype]}${desc}`);\n        }\n        return catchMaybePromise(() => sendMessage(msg), (err) => this._sendReject(msg, err));\n    }\n    // Rejects a RpcCall due to the given send error; this helper always re-throws.\n    _sendReject(msg, err) {\n        const newErr = new ErrorWithCode(\"RPC_SEND_FAILED\", `Send failed: ${err.message}`);\n        if (msg.mtype === message_1.MsgType.RpcCall && msg.reqId !== undefined) {\n            const callObj = this._pendingCalls.get(msg.reqId);\n            if (callObj) {\n                this._pendingCalls.delete(msg.reqId);\n                callObj.reject(newErr);\n            }\n        }\n        this.emit(\"error\", newErr);\n        throw newErr;\n    }\n    _makeCallRaw(iface, meth, args, resultChecker, fwdDest) {\n        return new Promise((resolve, reject) => {\n            const reqId = this._nextRequestId++;\n            const callObj = { reqId, iface, meth, resolve, reject, resultChecker };\n            this._pendingCalls.set(reqId, callObj);\n            // Send the Call message. If the sending fails, reject the _makeCall promise. If it\n            // succeeds, we save {resolve,reject} to resolve _makeCall when we get back a response.\n            this._info(callObj, \"RPC_CALLING\");\n            const msg = { mtype: message_1.MsgType.RpcCall, reqId, iface, meth, args };\n            if (fwdDest) {\n                msg.mdest = fwdDest;\n            }\n            // If _sendMessage fails, reject, allowing it to throw synchronously or not.\n            catchMaybePromise(() => this._sendMessage(msg), reject);\n        });\n    }\n    _makeCall(iface, meth, args, resultChecker, fwdDest) {\n        return this._callWrapper(() => this._makeCallRaw(iface, meth, args, resultChecker, fwdDest));\n    }\n    _dispatch(msg) {\n        switch (msg.mtype) {\n            case message_1.MsgType.RpcCall: {\n                this._onMessageCall(msg);\n                return;\n            }\n            case message_1.MsgType.RpcRespData:\n            case message_1.MsgType.RpcRespErr: {\n                this._onMessageResp(msg);\n                return;\n            }\n            case message_1.MsgType.Custom: {\n                this._onCustomMessage(msg);\n                return;\n            }\n            case message_1.MsgType.Ready: {\n                this._waitForReadyMessage = false;\n                try {\n                    this._processOutgoing();\n                }\n                catch (e) { /* swallowing error, an event 'error' was already emitted */ }\n                return;\n            }\n        }\n    }\n    _onCustomMessage(msg) {\n        if (msg.mdest) {\n            const impl = this._forwarders.get(msg.mdest) || this._forwarders.get(\"*\");\n            if (!impl) {\n                this._warn(null, \"RPC_UNKNOWN_FORWARD_DEST\", \"Unknown forward destination\");\n            }\n            else {\n                impl.forwardMessage(msg);\n            }\n        }\n        else {\n            this.emit(\"message\", msg.data);\n        }\n    }\n    _onMessageCall(call) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let impl;\n            if (call.mdest) {\n                impl = this._forwarders.get(call.mdest) || this._forwarders.get(\"*\");\n                if (!impl) {\n                    return this._failCall(call, \"RPC_UNKNOWN_FORWARD_DEST\", \"Unknown forward destination\");\n                }\n            }\n            else {\n                impl = this._implMap.get(call.iface);\n                if (!impl) {\n                    return this._failCall(call, \"RPC_UNKNOWN_INTERFACE\", \"Unknown interface\");\n                }\n            }\n            if (!impl.argsCheckers) {\n                // No call or argument checking.\n            }\n            else {\n                // Check the method name and argument types.\n                if (!impl.argsCheckers.hasOwnProperty(call.meth)) {\n                    return this._failCall(call, \"RPC_UNKNOWN_METHOD\", \"Unknown method\");\n                }\n                const argsChecker = impl.argsCheckers[call.meth];\n                try {\n                    argsChecker.check(call.args);\n                }\n                catch (e) {\n                    return this._failCall(call, \"RPC_INVALID_ARGS\", `Invalid args: ${e.message}`);\n                }\n            }\n            if (call.reqId === undefined) {\n                return this._failCall(call, \"RPC_MISSING_REQID\", \"Missing request id\");\n            }\n            this._info(call, \"RPC_ONCALL\");\n            let result;\n            try {\n                result = yield impl.invokeImpl(call);\n            }\n            catch (e) {\n                return this._failCall(call, e.code, e.message, \"RPC_ONCALL_ERROR\");\n            }\n            this._info(call, \"RPC_ONCALL_OK\");\n            return this._sendResponse(call.reqId, result);\n        });\n    }\n    _failCall(call, code, mesg, reportCode) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this._warn(call, reportCode || code, mesg);\n            if (call.reqId !== undefined) {\n                const msg = { mtype: message_1.MsgType.RpcRespErr, reqId: call.reqId, mesg, code };\n                yield this._sendMessage(msg);\n            }\n        });\n    }\n    _sendResponse(reqId, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const msg = { mtype: message_1.MsgType.RpcRespData, reqId, data };\n            yield this._sendMessage(msg);\n        });\n    }\n    _onMessageResp(resp) {\n        const callObj = this._pendingCalls.get(resp.reqId);\n        this._pendingCalls.delete(resp.reqId);\n        if (!callObj) {\n            this._warn(null, \"RPC_UNKNOWN_REQID\", `Response to unknown reqId ${resp.reqId}`);\n            return;\n        }\n        if (resp.mtype === message_1.MsgType.RpcRespErr) {\n            this._info(callObj, \"RPC_RESULT_ERROR\", resp.mesg);\n            return callObj.reject(new ErrorWithCode(resp.code, resp.mesg));\n        }\n        try {\n            callObj.resultChecker.check(resp.data);\n        }\n        catch (e) {\n            this._warn(callObj, \"RPC_RESULT_INVALID\", e.message);\n            return callObj.reject(new ErrorWithCode(\"RPC_INVALID_RESULT\", `Implementation produced invalid result: ${e.message}`));\n        }\n        this._info(callObj, \"RPC_RESULT_OK\");\n        callObj.resolve(resp.data);\n    }\n    _info(call, code, message) {\n        if (this._logger.info) {\n            const msg = message ? \" \" + message : \"\";\n            this._logger.info(`Rpc for ${this._callDesc(call)}: ${code}${msg}`);\n        }\n    }\n    _warn(call, code, message) {\n        if (this._logger.warn) {\n            const msg = message ? \" \" + message : \"\";\n            this._logger.warn(`Rpc for ${this._callDesc(call)}: ${code}${msg}`);\n        }\n    }\n    _callDesc(call) {\n        if (!call) {\n            return \"?\";\n        }\n        return `${call.iface}.${call.meth}#${call.reqId || \"-\"}`;\n    }\n    _parseName(name) {\n        const idx = name.lastIndexOf(\"@\");\n        if (idx === -1) {\n            return {\n                forwarder: \"\",\n                name,\n            };\n        }\n        return {\n            name: name.substr(0, idx),\n            forwarder: name.substr(idx + 1),\n        };\n    }\n}\nexports.Rpc = Rpc;\n/**\n * Interfaces may throw errors that include .code field, and it gets propagated to callers (e.g.\n * \"NOT_AUTHORIZED\"). Its purpose is to be a stable way to distinguish different types of errors.\n * This way the human-friendly error message can be changed without affecting behavior.\n */\nclass ErrorWithCode extends Error {\n    constructor(code, message) {\n        super(message);\n        this.code = code;\n    }\n}\nexports.ErrorWithCode = ErrorWithCode;\nconst IAnyFunc = tic.iface([], {\n    invoke: tic.func(\"any\"),\n});\nconst { IAnyFunc: checkerAnyFunc } = tic.createCheckers({ IAnyFunc });\nconst checkerAnyResult = checkerAnyFunc.methodResult(\"invoke\");\nconst anyChecker = checkerAnyResult;\n/**\n * A little helper that processes message queues when starting an rpc instance.\n */\nfunction processQueue(queue, processFunc) {\n    let i = 0;\n    try {\n        while (i < queue.length) {\n            // i gets read and then incremented before the call, so that if processFunc throws, the\n            // message still gets removed from the queue (to avoid processing it twice).\n            processFunc(queue[i++]);\n        }\n    }\n    finally {\n        queue.splice(0, i);\n    }\n}\n/**\n * Calls callback(), handling the exception both synchronously and not. If callback and handler\n * both return or throw synchronously, then so does this method.\n */\nfunction catchMaybePromise(callback, handler) {\n    try {\n        const p = callback();\n        if (p) {\n            return p.catch(handler);\n        }\n    }\n    catch (err) {\n        return handler(err);\n    }\n}\n","\"use strict\";\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Checker = exports.createCheckers = void 0;\nvar types_1 = require(\"./types\");\nvar util_1 = require(\"./util\");\n/**\n * Export functions used to define interfaces.\n */\nvar types_2 = require(\"./types\");\nObject.defineProperty(exports, \"TArray\", { enumerable: true, get: function () { return types_2.TArray; } });\nObject.defineProperty(exports, \"TEnumType\", { enumerable: true, get: function () { return types_2.TEnumType; } });\nObject.defineProperty(exports, \"TEnumLiteral\", { enumerable: true, get: function () { return types_2.TEnumLiteral; } });\nObject.defineProperty(exports, \"TFunc\", { enumerable: true, get: function () { return types_2.TFunc; } });\nObject.defineProperty(exports, \"TIface\", { enumerable: true, get: function () { return types_2.TIface; } });\nObject.defineProperty(exports, \"TLiteral\", { enumerable: true, get: function () { return types_2.TLiteral; } });\nObject.defineProperty(exports, \"TName\", { enumerable: true, get: function () { return types_2.TName; } });\nObject.defineProperty(exports, \"TOptional\", { enumerable: true, get: function () { return types_2.TOptional; } });\nObject.defineProperty(exports, \"TParam\", { enumerable: true, get: function () { return types_2.TParam; } });\nObject.defineProperty(exports, \"TParamList\", { enumerable: true, get: function () { return types_2.TParamList; } });\nObject.defineProperty(exports, \"TProp\", { enumerable: true, get: function () { return types_2.TProp; } });\nObject.defineProperty(exports, \"TTuple\", { enumerable: true, get: function () { return types_2.TTuple; } });\nObject.defineProperty(exports, \"TType\", { enumerable: true, get: function () { return types_2.TType; } });\nObject.defineProperty(exports, \"TUnion\", { enumerable: true, get: function () { return types_2.TUnion; } });\nObject.defineProperty(exports, \"TIntersection\", { enumerable: true, get: function () { return types_2.TIntersection; } });\nObject.defineProperty(exports, \"array\", { enumerable: true, get: function () { return types_2.array; } });\nObject.defineProperty(exports, \"enumlit\", { enumerable: true, get: function () { return types_2.enumlit; } });\nObject.defineProperty(exports, \"enumtype\", { enumerable: true, get: function () { return types_2.enumtype; } });\nObject.defineProperty(exports, \"func\", { enumerable: true, get: function () { return types_2.func; } });\nObject.defineProperty(exports, \"iface\", { enumerable: true, get: function () { return types_2.iface; } });\nObject.defineProperty(exports, \"lit\", { enumerable: true, get: function () { return types_2.lit; } });\nObject.defineProperty(exports, \"name\", { enumerable: true, get: function () { return types_2.name; } });\nObject.defineProperty(exports, \"opt\", { enumerable: true, get: function () { return types_2.opt; } });\nObject.defineProperty(exports, \"param\", { enumerable: true, get: function () { return types_2.param; } });\nObject.defineProperty(exports, \"tuple\", { enumerable: true, get: function () { return types_2.tuple; } });\nObject.defineProperty(exports, \"union\", { enumerable: true, get: function () { return types_2.union; } });\nObject.defineProperty(exports, \"intersection\", { enumerable: true, get: function () { return types_2.intersection; } });\nObject.defineProperty(exports, \"BasicType\", { enumerable: true, get: function () { return types_2.BasicType; } });\nvar util_2 = require(\"./util\");\nObject.defineProperty(exports, \"VError\", { enumerable: true, get: function () { return util_2.VError; } });\n/**\n * Takes one of more type suites (e.g. a module generated by `ts-interface-builder`), and combines\n * them into a suite of interface checkers. If a type is used by name, that name should be present\n * among the passed-in type suites.\n *\n * The returned object maps type names to Checker objects.\n */\nfunction createCheckers() {\n    var typeSuite = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        typeSuite[_i] = arguments[_i];\n    }\n    var fullSuite = Object.assign.apply(Object, __spreadArrays([{}, types_1.basicTypes], typeSuite));\n    var checkers = {};\n    for (var _a = 0, typeSuite_1 = typeSuite; _a < typeSuite_1.length; _a++) {\n        var suite_1 = typeSuite_1[_a];\n        for (var _b = 0, _c = Object.keys(suite_1); _b < _c.length; _b++) {\n            var name = _c[_b];\n            checkers[name] = new Checker(fullSuite, suite_1[name]);\n        }\n    }\n    return checkers;\n}\nexports.createCheckers = createCheckers;\n/**\n * Checker implements validation of objects, and also includes accessors to validate method calls.\n * Checkers should be created using `createCheckers()`.\n */\nvar Checker = /** @class */ (function () {\n    // Create checkers by using `createCheckers()` function.\n    function Checker(suite, ttype, _path) {\n        if (_path === void 0) { _path = 'value'; }\n        this.suite = suite;\n        this.ttype = ttype;\n        this._path = _path;\n        this.props = new Map();\n        if (ttype instanceof types_1.TIface) {\n            for (var _i = 0, _a = ttype.props; _i < _a.length; _i++) {\n                var p = _a[_i];\n                this.props.set(p.name, p.ttype);\n            }\n        }\n        this.checkerPlain = this.ttype.getChecker(suite, false);\n        this.checkerStrict = this.ttype.getChecker(suite, true);\n    }\n    /**\n     * Set the path to report in errors, instead of the default \"value\". (E.g. if the Checker is for\n     * a \"person\" interface, set path to \"person\" to report e.g. \"person.name is not a string\".)\n     */\n    Checker.prototype.setReportedPath = function (path) {\n        this._path = path;\n    };\n    /**\n     * Check that the given value satisfies this checker's type, or throw Error.\n     */\n    Checker.prototype.check = function (value) { return this._doCheck(this.checkerPlain, value); };\n    /**\n     * A fast check for whether or not the given value satisfies this Checker's type. This returns\n     * true or false, does not produce an error message, and is fast both on success and on failure.\n     */\n    Checker.prototype.test = function (value) {\n        return this.checkerPlain(value, new util_1.NoopContext());\n    };\n    /**\n     * Returns an error object describing the errors if the given value does not satisfy this\n     * Checker's type, or null if it does.\n     */\n    Checker.prototype.validate = function (value) {\n        return this._doValidate(this.checkerPlain, value);\n    };\n    /**\n     * Check that the given value satisfies this checker's type strictly. This checks that objects\n     * and tuples have no extra members. Note that this prevents backward compatibility, so usually\n     * a plain check() is more appropriate.\n     */\n    Checker.prototype.strictCheck = function (value) { return this._doCheck(this.checkerStrict, value); };\n    /**\n     * A fast strict check for whether or not the given value satisfies this Checker's type. Returns\n     * true or false, does not produce an error message, and is fast both on success and on failure.\n     */\n    Checker.prototype.strictTest = function (value) {\n        return this.checkerStrict(value, new util_1.NoopContext());\n    };\n    /**\n     * Returns an error object describing the errors if the given value does not satisfy this\n     * Checker's type strictly, or null if it does.\n     */\n    Checker.prototype.strictValidate = function (value) {\n        return this._doValidate(this.checkerStrict, value);\n    };\n    /**\n     * If this checker is for an interface, returns a Checker for the type required for the given\n     * property of this interface.\n     */\n    Checker.prototype.getProp = function (prop) {\n        var ttype = this.props.get(prop);\n        if (!ttype) {\n            throw new Error(\"Type has no property \" + prop);\n        }\n        return new Checker(this.suite, ttype, this._path + \".\" + prop);\n    };\n    /**\n     * If this checker is for an interface, returns a Checker for the argument-list required to call\n     * the given method of this interface. E.g. if this Checker is for the interface:\n     *    interface Foo {\n     *      find(s: string, pos?: number): number;\n     *    }\n     * Then methodArgs(\"find\").check(...) will succeed for [\"foo\"] and [\"foo\", 3], but not for [17].\n     */\n    Checker.prototype.methodArgs = function (methodName) {\n        var tfunc = this._getMethod(methodName);\n        return new Checker(this.suite, tfunc.paramList);\n    };\n    /**\n     * If this checker is for an interface, returns a Checker for the return value of the given\n     * method of this interface.\n     */\n    Checker.prototype.methodResult = function (methodName) {\n        var tfunc = this._getMethod(methodName);\n        return new Checker(this.suite, tfunc.result);\n    };\n    /**\n     * If this checker is for a function, returns a Checker for its argument-list.\n     */\n    Checker.prototype.getArgs = function () {\n        if (!(this.ttype instanceof types_1.TFunc)) {\n            throw new Error(\"getArgs() applied to non-function\");\n        }\n        return new Checker(this.suite, this.ttype.paramList);\n    };\n    /**\n     * If this checker is for a function, returns a Checker for its result.\n     */\n    Checker.prototype.getResult = function () {\n        if (!(this.ttype instanceof types_1.TFunc)) {\n            throw new Error(\"getResult() applied to non-function\");\n        }\n        return new Checker(this.suite, this.ttype.result);\n    };\n    /**\n     * Return the type for which this is a checker.\n     */\n    Checker.prototype.getType = function () {\n        return this.ttype;\n    };\n    /**\n     * Actual implementation of check() and strictCheck().\n     */\n    Checker.prototype._doCheck = function (checkerFunc, value) {\n        var noopCtx = new util_1.NoopContext();\n        if (!checkerFunc(value, noopCtx)) {\n            var detailCtx = new util_1.DetailContext();\n            checkerFunc(value, detailCtx);\n            throw detailCtx.getError(this._path);\n        }\n    };\n    Checker.prototype._doValidate = function (checkerFunc, value) {\n        var noopCtx = new util_1.NoopContext();\n        if (checkerFunc(value, noopCtx)) {\n            return null;\n        }\n        var detailCtx = new util_1.DetailContext();\n        checkerFunc(value, detailCtx);\n        return detailCtx.getErrorDetail(this._path);\n    };\n    Checker.prototype._getMethod = function (methodName) {\n        var ttype = this.props.get(methodName);\n        if (!ttype) {\n            throw new Error(\"Type has no property \" + methodName);\n        }\n        if (!(ttype instanceof types_1.TFunc)) {\n            throw new Error(\"Property \" + methodName + \" is not a method\");\n        }\n        return ttype;\n    };\n    return Checker;\n}());\nexports.Checker = Checker;\n","\"use strict\";\n/**\n * This module defines nodes used to define types and validations for objects and interfaces.\n */\n// tslint:disable:no-shadowed-variable prefer-for-of\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.basicTypes = exports.BasicType = exports.TParamList = exports.TParam = exports.param = exports.TFunc = exports.func = exports.TProp = exports.TOptional = exports.opt = exports.TIface = exports.iface = exports.TEnumLiteral = exports.enumlit = exports.TEnumType = exports.enumtype = exports.TIntersection = exports.intersection = exports.TUnion = exports.union = exports.TTuple = exports.tuple = exports.TArray = exports.array = exports.TLiteral = exports.lit = exports.TName = exports.name = exports.TType = void 0;\nvar util_1 = require(\"./util\");\n/** Node that represents a type. */\nvar TType = /** @class */ (function () {\n    function TType() {\n    }\n    return TType;\n}());\nexports.TType = TType;\n/** Parses a type spec into a TType node. */\nfunction parseSpec(typeSpec) {\n    return typeof typeSpec === \"string\" ? name(typeSpec) : typeSpec;\n}\nfunction getNamedType(suite, name) {\n    var ttype = suite[name];\n    if (!ttype) {\n        throw new Error(\"Unknown type \" + name);\n    }\n    return ttype;\n}\n/**\n * Defines a type name, either built-in, or defined in this suite. It can typically be included in\n * the specs as just a plain string.\n */\nfunction name(value) { return new TName(value); }\nexports.name = name;\nvar TName = /** @class */ (function (_super) {\n    __extends(TName, _super);\n    function TName(name) {\n        var _this = _super.call(this) || this;\n        _this.name = name;\n        _this._failMsg = \"is not a \" + name;\n        return _this;\n    }\n    TName.prototype.getChecker = function (suite, strict, allowedProps) {\n        var _this = this;\n        var ttype = getNamedType(suite, this.name);\n        var checker = ttype.getChecker(suite, strict, allowedProps);\n        if (ttype instanceof BasicType || ttype instanceof TName) {\n            return checker;\n        }\n        // For complex types, add an additional \"is not a <Type>\" message on failure.\n        return function (value, ctx) { return checker(value, ctx) ? true : ctx.fail(null, _this._failMsg, 0); };\n    };\n    return TName;\n}(TType));\nexports.TName = TName;\n/**\n * Defines a literal value, e.g. lit('hello') or lit(123).\n */\nfunction lit(value) { return new TLiteral(value); }\nexports.lit = lit;\nvar TLiteral = /** @class */ (function (_super) {\n    __extends(TLiteral, _super);\n    function TLiteral(value) {\n        var _this = _super.call(this) || this;\n        _this.value = value;\n        _this.name = JSON.stringify(value);\n        _this._failMsg = \"is not \" + _this.name;\n        return _this;\n    }\n    TLiteral.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        return function (value, ctx) { return (value === _this.value) ? true : ctx.fail(null, _this._failMsg, -1); };\n    };\n    return TLiteral;\n}(TType));\nexports.TLiteral = TLiteral;\n/**\n * Defines an array type, e.g. array('number').\n */\nfunction array(typeSpec) { return new TArray(parseSpec(typeSpec)); }\nexports.array = array;\nvar TArray = /** @class */ (function (_super) {\n    __extends(TArray, _super);\n    function TArray(ttype) {\n        var _this = _super.call(this) || this;\n        _this.ttype = ttype;\n        return _this;\n    }\n    TArray.prototype.getChecker = function (suite, strict) {\n        var itemChecker = this.ttype.getChecker(suite, strict);\n        return function (value, ctx) {\n            if (!Array.isArray(value)) {\n                return ctx.fail(null, \"is not an array\", 0);\n            }\n            for (var i = 0; i < value.length; i++) {\n                var ok = itemChecker(value[i], ctx);\n                if (!ok) {\n                    return ctx.fail(i, null, 1);\n                }\n            }\n            return true;\n        };\n    };\n    return TArray;\n}(TType));\nexports.TArray = TArray;\n/**\n * Defines a tuple type, e.g. tuple('string', 'number').\n */\nfunction tuple() {\n    var typeSpec = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        typeSpec[_i] = arguments[_i];\n    }\n    return new TTuple(typeSpec.map(function (t) { return parseSpec(t); }));\n}\nexports.tuple = tuple;\nvar TTuple = /** @class */ (function (_super) {\n    __extends(TTuple, _super);\n    function TTuple(ttypes) {\n        var _this = _super.call(this) || this;\n        _this.ttypes = ttypes;\n        return _this;\n    }\n    TTuple.prototype.getChecker = function (suite, strict) {\n        var itemCheckers = this.ttypes.map(function (t) { return t.getChecker(suite, strict); });\n        var checker = function (value, ctx) {\n            if (!Array.isArray(value)) {\n                return ctx.fail(null, \"is not an array\", 0);\n            }\n            for (var i = 0; i < itemCheckers.length; i++) {\n                var ok = itemCheckers[i](value[i], ctx);\n                if (!ok) {\n                    return ctx.fail(i, null, 1);\n                }\n            }\n            return true;\n        };\n        if (!strict) {\n            return checker;\n        }\n        return function (value, ctx) {\n            if (!checker(value, ctx)) {\n                return false;\n            }\n            return value.length <= itemCheckers.length ? true :\n                ctx.fail(itemCheckers.length, \"is extraneous\", 2);\n        };\n    };\n    return TTuple;\n}(TType));\nexports.TTuple = TTuple;\n/**\n * Defines a union type, e.g. union('number', 'null').\n */\nfunction union() {\n    var typeSpec = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        typeSpec[_i] = arguments[_i];\n    }\n    return new TUnion(typeSpec.map(function (t) { return parseSpec(t); }));\n}\nexports.union = union;\nvar TUnion = /** @class */ (function (_super) {\n    __extends(TUnion, _super);\n    function TUnion(ttypes) {\n        var _this = _super.call(this) || this;\n        _this.ttypes = ttypes;\n        var names = ttypes.map(function (t) { return t instanceof TName || t instanceof TLiteral ? t.name : null; })\n            .filter(function (n) { return n; });\n        var otherTypes = ttypes.length - names.length;\n        if (names.length) {\n            if (otherTypes > 0) {\n                names.push(otherTypes + \" more\");\n            }\n            _this._failMsg = \"is none of \" + names.join(\", \");\n        }\n        else {\n            _this._failMsg = \"is none of \" + otherTypes + \" types\";\n        }\n        return _this;\n    }\n    TUnion.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        var itemCheckers = this.ttypes.map(function (t) { return t.getChecker(suite, strict); });\n        return function (value, ctx) {\n            var ur = ctx.unionResolver();\n            for (var i = 0; i < itemCheckers.length; i++) {\n                var ok = itemCheckers[i](value, ur.createContext());\n                if (ok) {\n                    return true;\n                }\n            }\n            ctx.resolveUnion(ur);\n            return ctx.fail(null, _this._failMsg, 0);\n        };\n    };\n    return TUnion;\n}(TType));\nexports.TUnion = TUnion;\n/**\n * Defines an intersection type, e.g. intersection('number', 'null').\n */\nfunction intersection() {\n    var typeSpec = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        typeSpec[_i] = arguments[_i];\n    }\n    return new TIntersection(typeSpec.map(function (t) { return parseSpec(t); }));\n}\nexports.intersection = intersection;\nvar TIntersection = /** @class */ (function (_super) {\n    __extends(TIntersection, _super);\n    function TIntersection(ttypes) {\n        var _this = _super.call(this) || this;\n        _this.ttypes = ttypes;\n        return _this;\n    }\n    TIntersection.prototype.getChecker = function (suite, strict) {\n        var allowedProps = new Set();\n        var itemCheckers = this.ttypes.map(function (t) { return t.getChecker(suite, strict, allowedProps); });\n        return function (value, ctx) {\n            var ok = itemCheckers.every(function (checker) { return checker(value, ctx); });\n            if (ok) {\n                return true;\n            }\n            return ctx.fail(null, null, 0);\n        };\n    };\n    return TIntersection;\n}(TType));\nexports.TIntersection = TIntersection;\n/**\n * Defines an enum type, e.g. enum({'A': 1, 'B': 2}).\n */\nfunction enumtype(values) {\n    return new TEnumType(values);\n}\nexports.enumtype = enumtype;\nvar TEnumType = /** @class */ (function (_super) {\n    __extends(TEnumType, _super);\n    function TEnumType(members) {\n        var _this = _super.call(this) || this;\n        _this.members = members;\n        _this.validValues = new Set();\n        _this._failMsg = \"is not a valid enum value\";\n        _this.validValues = new Set(Object.keys(members).map(function (name) { return members[name]; }));\n        return _this;\n    }\n    TEnumType.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        return function (value, ctx) {\n            return (_this.validValues.has(value) ? true : ctx.fail(null, _this._failMsg, 0));\n        };\n    };\n    return TEnumType;\n}(TType));\nexports.TEnumType = TEnumType;\n/**\n * Defines a literal enum value, such as Direction.Up, specified as enumlit(\"Direction\", \"Up\").\n */\nfunction enumlit(name, prop) {\n    return new TEnumLiteral(name, prop);\n}\nexports.enumlit = enumlit;\nvar TEnumLiteral = /** @class */ (function (_super) {\n    __extends(TEnumLiteral, _super);\n    function TEnumLiteral(enumName, prop) {\n        var _this = _super.call(this) || this;\n        _this.enumName = enumName;\n        _this.prop = prop;\n        _this._failMsg = \"is not \" + enumName + \".\" + prop;\n        return _this;\n    }\n    TEnumLiteral.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        var ttype = getNamedType(suite, this.enumName);\n        if (!(ttype instanceof TEnumType)) {\n            throw new Error(\"Type \" + this.enumName + \" used in enumlit is not an enum type\");\n        }\n        var val = ttype.members[this.prop];\n        if (!ttype.members.hasOwnProperty(this.prop)) {\n            throw new Error(\"Unknown value \" + this.enumName + \".\" + this.prop + \" used in enumlit\");\n        }\n        return function (value, ctx) { return (value === val) ? true : ctx.fail(null, _this._failMsg, -1); };\n    };\n    return TEnumLiteral;\n}(TType));\nexports.TEnumLiteral = TEnumLiteral;\nfunction makeIfaceProps(props) {\n    return Object.keys(props).map(function (name) { return makeIfaceProp(name, props[name]); });\n}\nfunction makeIfaceProp(name, prop) {\n    return prop instanceof TOptional ?\n        new TProp(name, prop.ttype, true) :\n        new TProp(name, parseSpec(prop), false);\n}\n/**\n * Defines an interface. The first argument is an array of interfaces that it extends, and the\n * second is an array of properties.\n */\nfunction iface(bases, props) {\n    return new TIface(bases, makeIfaceProps(props));\n}\nexports.iface = iface;\nvar TIface = /** @class */ (function (_super) {\n    __extends(TIface, _super);\n    function TIface(bases, props) {\n        var _this = _super.call(this) || this;\n        _this.bases = bases;\n        _this.props = props;\n        _this.propSet = new Set(props.map(function (p) { return p.name; }));\n        return _this;\n    }\n    TIface.prototype.getChecker = function (suite, strict, allowedProps) {\n        var _this = this;\n        var baseCheckers = this.bases.map(function (b) { return getNamedType(suite, b).getChecker(suite, strict); });\n        var propCheckers = this.props.map(function (prop) { return prop.ttype.getChecker(suite, strict); });\n        var testCtx = new util_1.NoopContext();\n        // Consider a prop required if it's not optional AND does not allow for undefined as a value.\n        var isPropRequired = this.props.map(function (prop, i) {\n            return !prop.isOpt && !propCheckers[i](undefined, testCtx);\n        });\n        var checker = function (value, ctx) {\n            if (typeof value !== \"object\" || value === null) {\n                return ctx.fail(null, \"is not an object\", 0);\n            }\n            for (var i = 0; i < baseCheckers.length; i++) {\n                if (!baseCheckers[i](value, ctx)) {\n                    return false;\n                }\n            }\n            for (var i = 0; i < propCheckers.length; i++) {\n                var name_1 = _this.props[i].name;\n                var v = value[name_1];\n                if (v === undefined) {\n                    if (isPropRequired[i]) {\n                        return ctx.fail(name_1, \"is missing\", 1);\n                    }\n                }\n                else {\n                    var ok = propCheckers[i](v, ctx);\n                    if (!ok) {\n                        return ctx.fail(name_1, null, 1);\n                    }\n                }\n            }\n            return true;\n        };\n        if (!strict) {\n            return checker;\n        }\n        var propSet = this.propSet;\n        if (allowedProps) {\n            this.propSet.forEach(function (prop) { return allowedProps.add(prop); });\n            propSet = allowedProps;\n        }\n        // In strict mode, check also for unknown enumerable properties.\n        return function (value, ctx) {\n            if (!checker(value, ctx)) {\n                return false;\n            }\n            for (var prop in value) {\n                if (!propSet.has(prop)) {\n                    return ctx.fail(prop, \"is extraneous\", 2);\n                }\n            }\n            return true;\n        };\n    };\n    return TIface;\n}(TType));\nexports.TIface = TIface;\n/**\n * Defines an optional property on an interface.\n */\nfunction opt(typeSpec) { return new TOptional(parseSpec(typeSpec)); }\nexports.opt = opt;\nvar TOptional = /** @class */ (function (_super) {\n    __extends(TOptional, _super);\n    function TOptional(ttype) {\n        var _this = _super.call(this) || this;\n        _this.ttype = ttype;\n        return _this;\n    }\n    TOptional.prototype.getChecker = function (suite, strict) {\n        var itemChecker = this.ttype.getChecker(suite, strict);\n        return function (value, ctx) {\n            return value === undefined || itemChecker(value, ctx);\n        };\n    };\n    return TOptional;\n}(TType));\nexports.TOptional = TOptional;\n/**\n * Defines a property in an interface.\n */\nvar TProp = /** @class */ (function () {\n    function TProp(name, ttype, isOpt) {\n        this.name = name;\n        this.ttype = ttype;\n        this.isOpt = isOpt;\n    }\n    return TProp;\n}());\nexports.TProp = TProp;\n/**\n * Defines a function. The first argument declares the function's return type, the rest declare\n * its parameters.\n */\nfunction func(resultSpec) {\n    var params = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        params[_i - 1] = arguments[_i];\n    }\n    return new TFunc(new TParamList(params), parseSpec(resultSpec));\n}\nexports.func = func;\nvar TFunc = /** @class */ (function (_super) {\n    __extends(TFunc, _super);\n    function TFunc(paramList, result) {\n        var _this = _super.call(this) || this;\n        _this.paramList = paramList;\n        _this.result = result;\n        return _this;\n    }\n    TFunc.prototype.getChecker = function (suite, strict) {\n        return function (value, ctx) {\n            return typeof value === \"function\" ? true : ctx.fail(null, \"is not a function\", 0);\n        };\n    };\n    return TFunc;\n}(TType));\nexports.TFunc = TFunc;\n/**\n * Defines a function parameter.\n */\nfunction param(name, typeSpec, isOpt) {\n    return new TParam(name, parseSpec(typeSpec), Boolean(isOpt));\n}\nexports.param = param;\nvar TParam = /** @class */ (function () {\n    function TParam(name, ttype, isOpt) {\n        this.name = name;\n        this.ttype = ttype;\n        this.isOpt = isOpt;\n    }\n    return TParam;\n}());\nexports.TParam = TParam;\n/**\n * Defines a function parameter list.\n */\nvar TParamList = /** @class */ (function (_super) {\n    __extends(TParamList, _super);\n    function TParamList(params) {\n        var _this = _super.call(this) || this;\n        _this.params = params;\n        return _this;\n    }\n    TParamList.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        var itemCheckers = this.params.map(function (t) { return t.ttype.getChecker(suite, strict); });\n        var testCtx = new util_1.NoopContext();\n        var isParamRequired = this.params.map(function (param, i) {\n            return !param.isOpt && !itemCheckers[i](undefined, testCtx);\n        });\n        var checker = function (value, ctx) {\n            if (!Array.isArray(value)) {\n                return ctx.fail(null, \"is not an array\", 0);\n            }\n            for (var i = 0; i < itemCheckers.length; i++) {\n                var p = _this.params[i];\n                if (value[i] === undefined) {\n                    if (isParamRequired[i]) {\n                        return ctx.fail(p.name, \"is missing\", 1);\n                    }\n                }\n                else {\n                    var ok = itemCheckers[i](value[i], ctx);\n                    if (!ok) {\n                        return ctx.fail(p.name, null, 1);\n                    }\n                }\n            }\n            return true;\n        };\n        if (!strict) {\n            return checker;\n        }\n        return function (value, ctx) {\n            if (!checker(value, ctx)) {\n                return false;\n            }\n            return value.length <= itemCheckers.length ? true :\n                ctx.fail(itemCheckers.length, \"is extraneous\", 2);\n        };\n    };\n    return TParamList;\n}(TType));\nexports.TParamList = TParamList;\n/**\n * Single TType implementation for all basic built-in types.\n */\nvar BasicType = /** @class */ (function (_super) {\n    __extends(BasicType, _super);\n    function BasicType(validator, message) {\n        var _this = _super.call(this) || this;\n        _this.validator = validator;\n        _this.message = message;\n        return _this;\n    }\n    BasicType.prototype.getChecker = function (suite, strict) {\n        var _this = this;\n        return function (value, ctx) { return _this.validator(value) ? true : ctx.fail(null, _this.message, 0); };\n    };\n    return BasicType;\n}(TType));\nexports.BasicType = BasicType;\n/**\n * Defines the suite of basic types.\n */\nexports.basicTypes = {\n    any: new BasicType(function (v) { return true; }, \"is invalid\"),\n    number: new BasicType(function (v) { return (typeof v === \"number\"); }, \"is not a number\"),\n    object: new BasicType(function (v) { return (typeof v === \"object\" && v); }, \"is not an object\"),\n    boolean: new BasicType(function (v) { return (typeof v === \"boolean\"); }, \"is not a boolean\"),\n    string: new BasicType(function (v) { return (typeof v === \"string\"); }, \"is not a string\"),\n    symbol: new BasicType(function (v) { return (typeof v === \"symbol\"); }, \"is not a symbol\"),\n    void: new BasicType(function (v) { return (v == null); }, \"is not void\"),\n    undefined: new BasicType(function (v) { return (v === undefined); }, \"is not undefined\"),\n    null: new BasicType(function (v) { return (v === null); }, \"is not null\"),\n    never: new BasicType(function (v) { return false; }, \"is unexpected\"),\n    Date: new BasicType(getIsNativeChecker(\"[object Date]\"), \"is not a Date\"),\n    RegExp: new BasicType(getIsNativeChecker(\"[object RegExp]\"), \"is not a RegExp\"),\n};\n// This approach for checking native object types mirrors that of lodash. Its advantage over\n// `isinstance` is that it can still return true for native objects created in different JS\n// execution environments.\nvar nativeToString = Object.prototype.toString;\nfunction getIsNativeChecker(tag) {\n    return function (v) { return typeof v === \"object\" && v && nativeToString.call(v) === tag; };\n}\nif (typeof Buffer !== \"undefined\") {\n    exports.basicTypes.Buffer = new BasicType(function (v) { return Buffer.isBuffer(v); }, \"is not a Buffer\");\n}\nvar _loop_1 = function (array_1) {\n    exports.basicTypes[array_1.name] = new BasicType(function (v) { return (v instanceof array_1); }, \"is not a \" + array_1.name);\n};\n// Support typed arrays of various flavors\nfor (var _i = 0, _a = [Int8Array, Uint8Array, Uint8ClampedArray, Int16Array, Uint16Array,\n    Int32Array, Uint32Array, Float32Array, Float64Array, ArrayBuffer]; _i < _a.length; _i++) {\n    var array_1 = _a[_i];\n    _loop_1(array_1);\n}\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DetailContext = exports.NoopContext = exports.VError = void 0;\n/**\n * Error thrown by validation. Besides an informative message, it includes the path to the\n * property which triggered the failure.\n */\nvar VError = /** @class */ (function (_super) {\n    __extends(VError, _super);\n    function VError(path, message) {\n        var _this = _super.call(this, message) || this;\n        _this.path = path;\n        // See https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work for info about this workaround.\n        Object.setPrototypeOf(_this, VError.prototype);\n        return _this;\n    }\n    return VError;\n}(Error));\nexports.VError = VError;\n/**\n * Fast implementation of IContext used for first-pass validation. If that fails, we can validate\n * using DetailContext to collect error messages. That's faster for the common case when messages\n * normally pass validation.\n */\nvar NoopContext = /** @class */ (function () {\n    function NoopContext() {\n    }\n    NoopContext.prototype.fail = function (relPath, message, score) {\n        return false;\n    };\n    NoopContext.prototype.unionResolver = function () { return this; };\n    NoopContext.prototype.createContext = function () { return this; };\n    NoopContext.prototype.resolveUnion = function (ur) { };\n    return NoopContext;\n}());\nexports.NoopContext = NoopContext;\n/**\n * Complete implementation of IContext that collects meaningfull errors.\n */\nvar DetailContext = /** @class */ (function () {\n    function DetailContext() {\n        // Stack of property names and associated messages for reporting helpful error messages.\n        this._propNames = [\"\"];\n        this._messages = [null];\n        // Score is used to choose the best union member whose DetailContext to use for reporting.\n        // Higher score means better match (or rather less severe mismatch).\n        this._score = 0;\n    }\n    DetailContext.prototype.fail = function (relPath, message, score) {\n        this._propNames.push(relPath);\n        this._messages.push(message);\n        this._score += score;\n        return false;\n    };\n    DetailContext.prototype.unionResolver = function () {\n        return new DetailUnionResolver();\n    };\n    DetailContext.prototype.resolveUnion = function (unionResolver) {\n        var _a, _b;\n        var u = unionResolver;\n        var best = null;\n        for (var _i = 0, _c = u.contexts; _i < _c.length; _i++) {\n            var ctx = _c[_i];\n            if (!best || ctx._score >= best._score) {\n                best = ctx;\n            }\n        }\n        if (best && best._score > 0) {\n            (_a = this._propNames).push.apply(_a, best._propNames);\n            (_b = this._messages).push.apply(_b, best._messages);\n        }\n    };\n    DetailContext.prototype.getError = function (path) {\n        var msgParts = [];\n        for (var i = this._propNames.length - 1; i >= 0; i--) {\n            var p = this._propNames[i];\n            path += (typeof p === \"number\") ? \"[\" + p + \"]\" : (p ? \".\" + p : \"\");\n            var m = this._messages[i];\n            if (m) {\n                msgParts.push(path + \" \" + m);\n            }\n        }\n        return new VError(path, msgParts.join(\"; \"));\n    };\n    DetailContext.prototype.getErrorDetail = function (path) {\n        var details = [];\n        for (var i = this._propNames.length - 1; i >= 0; i--) {\n            var p = this._propNames[i];\n            path += (typeof p === \"number\") ? \"[\" + p + \"]\" : (p ? \".\" + p : \"\");\n            var message = this._messages[i];\n            if (message) {\n                details.push({ path: path, message: message });\n            }\n        }\n        var detail = null;\n        for (var i = details.length - 1; i >= 0; i--) {\n            if (detail) {\n                details[i].nested = [detail];\n            }\n            detail = details[i];\n        }\n        return detail;\n    };\n    return DetailContext;\n}());\nexports.DetailContext = DetailContext;\nvar DetailUnionResolver = /** @class */ (function () {\n    function DetailUnionResolver() {\n        this.contexts = [];\n    }\n    DetailUnionResolver.prototype.createContext = function () {\n        var ctx = new DetailContext();\n        this.contexts.push(ctx);\n        return ctx;\n    };\n    return DetailUnionResolver;\n}());\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import {Rpc} from 'grain-rpc';\n\nconst rpc = new Rpc({logger: {}, sendMessage: postMessage as any});\nonmessage = (ev) => rpc.receiveMessage(ev.data);\n\nconst bank = rpc.getStub<any>('bank');\n\nrpc.registerFunc('runUserCode', async (code: string) => {\n  const userFunc = Function('transfer', 'getBalance',\n    `return async function() { ${code} }`)(bank.transfer, bank.getBalance);\n  await userFunc();\n});\n"],"sourceRoot":""}